/*! 1.0.4 */
(function(t,e){function a(){function e(){a(),o(),s(),l(),h()}function a(){T.postChoosers=t(".snap-post-chooser"),T.placeholders=t(".snap-attached-posts"),T.searchFields=t(".snap-apa-input"),T.pageTemplateSelect=t("#page_template"),T.portfolioWrapper=t("#snap_portfolio_posts"),T.homepageWrapper=t("#snap_homepage_posts"),T.homepageMBToggle=t("#snap_homepage_posts-hide"),T.portfolioMBToggle=t("#snap_portfolio_posts-hide"),_=snapData}function o(){T.postChoosers.on("click","a.tab-link",function(t){n(this),t.preventDefault()}),T.postChoosers.on("click","a.snap-recent-post",function(e){var a=t(this),o=a.attr("data-id"),n=a.attr("data-title");r(n,o,"link",this),e.preventDefault()}),T.placeholders.on("click",".snap-remove-item",function(t){i(this),t.preventDefault()}),T.pageTemplateSelect.on("change",h)}function n(e){var a=t(e),o=a.parents(".snap-post-chooser"),n=t(a.attr("href"),o),s=t(".tabs-panel",o);a.parent().addClass("tabs").siblings("li").removeClass("tabs"),s.removeClass("snap-active-tab").addClass("snap-inactive-tab"),n.addClass("snap-active-tab").removeClass("snap-inactive-tab")}function s(){T.searchFields.autocomplete({minLength:3,position:{collision:"fit"},source:function(t,e){var a=t.term;return a in C?(e(C[a]),void 0):(p(t,e,a,_),void 0)},focus:function(e,a){return t(this).val(a.item.label),!1},select:function(e,a){t(this).val(""),r(a.item.label,a.item.value,"select",this),e.preventDefault()}})}function p(e,a,o,n){return t.ajax({url:ajaxurl,type:"POST",data:{snap_apa_term:o,snap_apa_nonce:n.nonce,action:n.action},dataType:"json",success:function(t){C[o]=t,a(t)}})}function r(e,a,o,n){var s=t(n),p=s.parents(".postbox"),r=p.attr("id"),i=t(".snap-attached-posts",p),l=t(".snap-current-posts",p),u=g(l);if(-1===t.inArray(a+"",u)){var h=c(r,a,e);i.prepend(h),u.unshift(a),m(l,d(u)),t(".snap-no-posts",p).hide()}}function i(e){var a=t(e),o=a.parent(),n=o.attr("data-id"),s=a.parents(".postbox"),p=t(".snap-current-posts",s),r=g(p),i=t.inArray(n+"",r);r.splice(i,1),p.val(d(r)),o.fadeOut(300,function(){t(this).remove(),0===t(".snap-attached-posts li",s).length&&t(".snap-no-posts",s).show()})}function c(t,e,a){return'<li id="'+t+"-"+e+'" data-id="'+e+'">'+a+' <a title="'+_.removePostsTitleAttr+'" class="snap-remove-item" href="#">'+_.removePostsLinkText+"</a></li>"}function l(){T.placeholders.sortable({placeholder:"snap-attached-posts-sortable-placeholder",forcePlaceholderSize:!0,cursor:"move",stop:function(t,e){u(t,e,this)}})}function u(e,a,o){var n=[],s=t(o),p=s.parents(".postbox"),r=t(".snap-current-posts",p);t(".snap-attached-posts li",p).each(function(){n.push(t(this).attr("data-id"))}),m(r,n)}function h(){"homepage.php"===b()?(T.homepageWrapper.show(),T.portfolioWrapper.hide()):"portfolio.php"===b()?(T.portfolioWrapper.show(),T.homepageWrapper.hide()):(T.portfolioWrapper.hide(),T.homepageWrapper.hide())}function f(t){return t.split(",")}function d(t){return t.join(",")}function v(t){return t.val()}function m(t,e){return t.val(e)}function g(t){return f(v(t))}function b(){return T.pageTemplateSelect.val()}var _,C={},T={};e()}e.SnapAttachedPosts=new a})(jQuery,window);